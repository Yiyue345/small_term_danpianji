C51 COMPILER V9.56.0.0   MAIN                                                              07/11/2025 17:10:32 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "reg52.h"
   2          #include "ls138.h"
   3          #include "smg.h"
   4          #include "delay.h"
   5          #include "iic.h"
   6          #include "keyboard.h"
   7          #include "ds1302.h"
   8          
   9          sbit  RST=P2^4;         
  10          sbit  CLK=P2^3;          
  11          sbit  DP=P2^2;           
  12          
  13          sbit L1 = P0^0;
  14          sbit L8 = P0^7;
  15          
  16          //�ӳٺ���       
  17          
  18          void delay(unsigned int m)       
  19          {
  20   1        
  21   1      unsigned int i,j;
  22   1      for(i=0;i<m;i++)
  23   1        
  24   1      {
  25   2         for(j=0;j<121;j++){}      
  26   2      }
  27   1      }
  28          //��ʱ��T0
  29          void InitTimer0()
  30          {
  31   1        TMOD = 0x01;
  32   1        TH0 = (65535 - 50000) / 256;
  33   1        TL0 = (65535 - 50000) % 256;
  34   1        
  35   1        ET0 = 1;
  36   1        EA = 1;
  37   1        TR0 = 1;
  38   1      }
  39          
  40          // DS1302 ָ��д��
  41          void WriteCommand(unsigned char Command)
  42          {
  43   1      unsigned char i;
  44   1      RST=0;
  45   1      CLK=0;
  46   1      RST=1;
  47   1      for(i=8;i>0;i--)
  48   1           {
  49   2          DP=Command&0x01;
  50   2          CLK=1;
  51   2          Command>>=1;
  52   2         }
  53   1      }
  54          
  55          
C51 COMPILER V9.56.0.0   MAIN                                                              07/11/2025 17:10:32 PAGE 2   

  56          //DS1302 ����д��
  57          void WriteData(unsigned char SendDat)
  58          {
  59   1      unsigned char i;
  60   1      for(i=8;i>0;i--)
  61   1           {
  62   2          DP=SendDat&0x01;
  63   2          CLK=1;
  64   2          SendDat>>=1;
  65   2         }
  66   1      }
  67          
  68          
  69          //DS1302 ��ȡ����
  70          unsigned char ReadData()
  71          {
  72   1        unsigned char i,RecDat=0;
  73   1        for(i=0;i<8;i++)
  74   1           {
  75   2          CLK=1;
  76   2          CLK=0;
  77   2          if(DP)RecDat|=0x01<<i;
  78   2         }
  79   1         return(RecDat);
  80   1      }     
  81          
  82          //DS1302���ֽ�����д��Ͷ�ȡ
  83          void WriteByte(unsigned char Command,unsigned char SendDat)
  84          {
  85   1        WriteCommand(Command);
  86   1        WriteData(SendDat);
  87   1        RST=0;
  88   1      }
  89          unsigned char ReadByte(unsigned char Command)
  90          {
  91   1        unsigned char RecDat=0;
  92   1        WriteCommand(Command);
  93   1        RecDat=ReadData();
  94   1        RST=0;
  95   1        return(RecDat);
  96   1      }
  97          
  98          
  99          //��ʾLED 
 100          
 101          void Init_smgled(){
 102   1      
 103   1      
 104   1      }
 105          
 106          
 107          void updatesmg(){
 108   1       
 109   1      }
 110          
 111          //�жϷ������
 112          unsigned char count = 0;
 113          void serviceTimer0() interrupt 1{
 114   1        TH0 = (65535 - 50000) / 256;
 115   1        TL0 = (65535 - 50000) % 256;
 116   1        
 117   1        count++;
C51 COMPILER V9.56.0.0   MAIN                                                              07/11/2025 17:10:32 PAGE 3   

 118   1        if(count % 10 == 0)
 119   1        {
 120   2          L1 = ~L1;
 121   2        }
 122   1        if(count == 100)
 123   1        {
 124   2          L8 = ~L8;
 125   2          count = 0;
 126   2        }
 127   1      
 128   1      }
 129            
 130          //��main�����������Ŀ�߼�����
 131          void main() {
 132   1        // 初始化定时器
 133   1        InitTimer0();
 134   1        
 135   1        // 初始化DS1302
 136   1        Ds1302_Init();
 137   1        
 138   1        // 延时一下让DS1302稳定
 139   1        delay(100);
 140   1        
 141   1        // 写入默认时间
 142   1        Ds1302_Write_Time(); 
 143   1        
 144   1        // 再次延时
 145   1        delay(100);
 146   1        
 147   1        while (1) {
 148   2          // 读取当前时间
 149   2          Ds1302_Read_Time();
 150   2          
 151   2          // 显示时:分:秒 格式
 152   2          updateLed(0, cur_time_buf[2] / 10);  // 时的十位
 153   2          updateLed(1, cur_time_buf[2] % 10);  // 时的个位
 154   2          updateLed(2, 11);                    // 分隔符 "-"
 155   2          updateLed(3, cur_time_buf[1] / 10);  // 分的十位
 156   2          updateLed(4, cur_time_buf[1] % 10);  // 分的个位
 157   2          updateLed(5, 11);                    // 分隔符 "-"
 158   2          updateLed(6, cur_time_buf[0] / 10);  // 秒的十位
 159   2          updateLed(7, cur_time_buf[0] % 10);  // 秒的个位
 160   2      
 161   2          showLed();
 162   2          
 163   2          // 添加延时，避免读取过于频繁
 164   2          delay(10);
 165   2        }
 166   1        
 167   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    306    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
